<h2>Flight Search</h2>

<form [formGroup]="flightSearchForm" (ngSubmit)="onSubmit()" novalidate>

  <div>
    <label for="departureId">Departure Airport ID:</label>
    <input id="departureId" type="text" formControlName="departureId">
    <div *ngIf="flightSearchForm.controls['departureId'].invalid && (flightSearchForm.controls['departureId'].dirty || flightSearchForm.controls['departureId'].touched)">
      <small *ngIf="flightSearchForm.controls['departureId'].errors?.['required']">Departure ID is required.</small>
    </div>
  </div>

  <div>
    <label for="arrivalId">Arrival Airport ID:</label>
    <input id="arrivalId" type="text" formControlName="arrivalId">
    <div *ngIf="flightSearchForm.controls['arrivalId'].invalid && (flightSearchForm.controls['arrivalId'].dirty || flightSearchForm.controls['arrivalId'].touched)">
      <small *ngIf="flightSearchForm.controls['arrivalId'].errors?.['required']">Arrival ID is required.</small>
    </div>
  </div>

  <div>
    <label for="outboundDate">Outbound Date:</label>
    <input id="outboundDate" type="date" formControlName="outboundDate">
    <div *ngIf="flightSearchForm.controls['outboundDate'].invalid && (flightSearchForm.controls['outboundDate'].dirty || flightSearchForm.controls['outboundDate'].touched)">
      <small *ngIf="flightSearchForm.controls['outboundDate'].errors?.['required']">Outbound date is required.</small>
    </div>
  </div>

  <div>
    <label for="returnDate">Return Date:</label>
    <input id="returnDate" type="date" formControlName="returnDate">
    <!-- No required validation for return date -->
  </div>

  <div>
    <label>Trip Type:</label>
    <label>
      <input type="radio" formControlName="type" [value]="1"> Round Trip
    </label>
    <label>
      <input type="radio" formControlName="type" [value]="2"> One Way
    </label>
    <div *ngIf="flightSearchForm.controls['type'].invalid && (flightSearchForm.controls['type'].dirty || flightSearchForm.controls['type'].touched)">
      <small *ngIf="flightSearchForm.controls['type'].errors?.['required']">Trip type is required.</small>
    </div>
  </div>

  <div>
    <label for="adults">Adults:</label>
    <input id="adults" type="number" formControlName="adults" min="1">
    <div *ngIf="flightSearchForm.controls['adults'].invalid && (flightSearchForm.controls['adults'].dirty || flightSearchForm.controls['adults'].touched)">
      <small *ngIf="flightSearchForm.controls['adults'].errors?.['required']">Number of adults is required.</small>
      <small *ngIf="flightSearchForm.controls['adults'].errors?.['min']">At least 1 adult is required.</small>
    </div>
  </div>

  <div>
    <label for="children">Children (2-11):</label>
    <input id="children" type="number" formControlName="children" min="0">
     <div *ngIf="flightSearchForm.controls['children'].invalid && (flightSearchForm.controls['children'].dirty || flightSearchForm.controls['children'].touched)">
      <small *ngIf="flightSearchForm.controls['children'].errors?.['min']">Number of children cannot be negative.</small>
    </div>
  </div>

  <div>
    <label for="infantsInSeat">Infants (in seat):</label>
    <input id="infantsInSeat" type="number" formControlName="infantsInSeat" min="0">
    <div *ngIf="flightSearchForm.controls['infantsInSeat'].invalid && (flightSearchForm.controls['infantsInSeat'].dirty || flightSearchForm.controls['infantsInSeat'].touched)">
        <small *ngIf="flightSearchForm.controls['infantsInSeat'].errors?.['min']">Number of infants in seat cannot be negative.</small>
    </div>
  </div>

  <div>
    <label for="infantsOnLap">Infants (on lap):</label>
    <input id="infantsOnLap" type="number" formControlName="infantsOnLap" min="0">
    <div *ngIf="flightSearchForm.controls['infantsOnLap'].invalid && (flightSearchForm.controls['infantsOnLap'].dirty || flightSearchForm.controls['infantsOnLap'].touched)">
      <small *ngIf="flightSearchForm.controls['infantsOnLap'].errors?.['min']">Number of infants on lap cannot be negative.</small>
    </div>
  </div>

  <button type="submit" [disabled]="!flightSearchForm.valid || isLoading">
    {{ isLoading ? 'Searching...' : 'Search Flights' }}
  </button>

</form>

<!-- Loading Indicator -->
<div *ngIf="isLoading" class="loading-indicator">
  Searching for flights...
</div>

<!-- Error Display -->
<div *ngIf="searchError" class="error-message">
  <h4>Search Error</h4>
  <p>{{ searchError }}</p>
</div>

<!-- Results Display -->
<div *ngIf="flightResults && !isLoading">
  <h3>Search Results</h3>

  <div *ngIf="flightResults.errorMessage">
    <p class="error-message">Error from API: {{ flightResults.errorMessage }}</p>
  </div>

  <div *ngIf="!flightResults.bestFlights && !flightResults.otherFlights && !flightResults.errorMessage">
    <p>No flights found for your criteria.</p>
  </div>

  <!-- Display Best Flights -->
  <div *ngIf="flightResults.bestFlights && flightResults.bestFlights.length > 0">
    <h4>Best Flights</h4>
    <ul>
      <li *ngFor="let flight of flightResults.bestFlights">
        Price: {{ flight.price | currency }} ({{ flight.type }}) - Total Duration: {{ flight.totalDuration }} minutes
        <!-- Add more details as needed -->
         <ul>
          <li *ngFor="let segment of flight.flights">
            {{ segment.airline }} ({{ segment.flightNumber }}) : {{ segment.departureAirport.id }} -> {{ segment.arrivalAirport.id }}
          </li>
        </ul>
      </li>
    </ul>
  </div>

  <!-- Optionally display Other Flights -->
  <div *ngIf="flightResults.otherFlights && flightResults.otherFlights.length > 0">
    <h4>Other Flights</h4>
    <ul>
      <li *ngFor="let flight of flightResults.otherFlights">
         Price: {{ flight.price | currency }} ({{ flight.type }}) - Total Duration: {{ flight.totalDuration }} minutes
        <!-- Add more details as needed -->
      </li>
    </ul>
  </div>

  <!-- Optionally display Price Insights -->
  <div *ngIf="flightResults.priceInsights">
    <h4>Price Insights</h4>
    <!-- Display price insights details -->
    <p>Typical price: {{ flightResults.priceInsights.lowestPrice | currency }} - {{ flightResults.priceInsights.priceLevel }}</p>
  </div>

</div>
